# Firebase Auth Migration Plan

## Objective
Migrate the Flutter application from NextAuth (cookie-based) to native Firebase Auth. This involves removing session management code and integrating `firebase_auth` for direct authentication with Firebase, which will then issue ID tokens to be sent to the backend.

## Prerequisites (Needs from User)
- [ ] **Firebase Configuration**: The `lib/firebase_options.dart` file contains placeholder values (`TODO`).
    -   **Action**: Please run `flutterfire configure` to generate the correct configuration for your project.
    -   **Alternatively**: Provide the `apiKey`, `appId`, `projectId`, etc., so I can update the file.
- [ ] **Linux Support**: The current code explicitly disables Firebase on Linux (`lib/utils/firebase.dart`). If you intend to run this on Linux, verify if `firebase_auth` supports it (often via web fallback or community packages) or if we should focus on Android/Web.

## Checklist

### 1. Cleanup Dependencies
- [ ] Remove `dio_cookie_manager` and `cookie_jar` from `pubspec.yaml`.
- [ ] Run `flutter pub get`.

### 2. Code Cleanup & Refactoring
- [ ] **`lib/domain/di/spot_module.dart`**:
    -   Remove `cookiePath` parameter from `registerDependencies`.
    -   Update `DioClient` instantiation.
- [ ] **`lib/domain/io/net/dio_client.dart`**:
    -   Remove `CookieManager` and `PersistCookieJar`.
    -   Refactor the `Authorization` header interceptor to fetch the Firebase ID token:
        ```dart
        final user = FirebaseAuth.instance.currentUser;
        if (user != null) {
            final token = await user.getIdToken();
            options.headers['Authorization'] = 'Bearer $token';
        }
        ```
- [ ] **`lib/services/api_service.dart`**:
    -   Import `firebase_auth`.
    -   Refactor `signIn`: Use `FirebaseAuth.instance.signInWithEmailAndPassword`. Remove CSRF/NextAuth logic.
    -   Refactor `signUp`: Use `FirebaseAuth.instance.createUserWithEmailAndPassword`.
    -   Refactor `signOut`: Use `FirebaseAuth.instance.signOut`.
    -   Remove `SharedPreferences` usage for token storage (unless used for other flags).
- [ ] **`lib/main.dart` / `lib/config/application.dart`**:
    -   Remove `getApplicationDocumentsDirectory` call used solely for cookies.
    -   Ensure `initializeFirebase()` is called (uncomment in `main.dart`).

### 3. Verification
- [ ] Analyze project for errors (`flutter analyze`).
- [ ] Attempt to build (requires valid `firebase_options.dart`).

## Next Steps
1.  Approve this plan.
2.  Provide Firebase configuration (or run `flutterfire configure`).
3.  I will execute the code changes.
