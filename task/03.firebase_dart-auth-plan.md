# Plan: Ensure Trip Planner uses `firebase_dart` for Auth (Google Sign-In)

## Goal
- [x] Confirm the app’s sign-in flow is implemented and backed by `firebase_dart` (not `firebase_auth` / `flutterfire`), so tapping **Sign in with Google** runs a real auth flow rather than showing **Not implemented yet**.

## Checklist

### 1) Inventory current auth implementation
- [x] Locate the UI entry point that shows **“Sign in with Google - Not implemented yet”** (screen/widget + button handler).
- [x] Identify where auth state is stored/managed (Provider, Riverpod, custom service, etc.).
- [x] Identify current Firebase/Auth packages used in `pubspec.yaml` (e.g., `firebase_auth`, `firebase_core`, `google_sign_in`, etc.).

### 2) Confirm platform targets and constraints
- [x] List supported platforms for this project (Android/iOS/Web/Desktop).
- [x] Decide whether `firebase_dart` will be used on all platforms, or only on non-mobile targets.
- [x] Confirm whether Google Sign-In must work on:
  - [x] Android
  - [x] iOS
  - [x] Web
  - [x] Desktop (macOS/Windows/Linux)

### 3) Validate `firebase_dart` viability for the project
- [x] Confirm `firebase_dart` supports the required sign-in methods for the chosen platforms.
- [x] Decide the OAuth flow approach per platform:
  - [x] Use `google_sign_in` to obtain Google ID token + access token (mobile/desktop) and pass credentials into Firebase
  - [x] Use web popup/redirect flow (web)
  - [x] If unsupported, document the constraint and choose a compatible approach

### 4) Dependency plan (`pubspec.yaml`)
- [x] Add/confirm `firebase_dart` (and any companion packages it requires) in `pubspec.yaml`.
- [x] Remove or stop using conflicting FlutterFire auth packages if the goal is to exclusively use `firebase_dart`:
  - [x] `firebase_auth`
  - [x] `firebase_core`
  - [x] any FlutterFire initialization code
- [x] Confirm a single, consistent Firebase initialization path is used across the app.

### 5) Firebase initialization strategy
- [x] Identify where Firebase is initialized today (likely `main.dart`).
- [x] Replace/plan to replace initialization with `firebase_dart` initialization.
- [x] Ensure the Firebase project configuration is sourced correctly for all platforms:
  - [x] Determine where API key / projectId / appId / messagingSenderId are coming from (dotenv, config file, etc.).
  - [x] Decide where those values will live for `firebase_dart` (and ensure they are not committed if sensitive).

### 6) Implement Google sign-in using `firebase_dart`
- [x] Create/confirm an `AuthService` abstraction so UI does not directly call Firebase APIs.
- [x] Implement `signInWithGoogle()` using the chosen platform flow, ending in a Firebase credential sign-in via `firebase_dart`.
- [x] Implement `signOut()` (invalidate local session + provider state).
- [x] Expose an auth state stream/listener to drive UI (signed-in vs signed-out).

### 7) Replace the “Not implemented yet” UI path
- [x] Wire the Google sign-in button to `AuthService.signInWithGoogle()`.
- [x] Show actionable error messages (network error, cancelled sign-in, misconfiguration).
- [x] Ensure loading states and button disabling are handled to prevent double taps.

### 8) Configuration verification (Google provider)
- [x] Confirm Google provider is enabled in Firebase Console for the project.
- [x] Confirm correct OAuth client IDs / SHA-1/SHA-256 fingerprints (Android) are configured.
- [x] Confirm iOS URL schemes / reversed client ID configuration is present if iOS is targeted.
- [x] Confirm web origin / authorized redirect URIs are configured if Web is targeted.

### 9) Testing plan
- [x] Add a minimal integration test plan:
  - [x] Successful Google sign-in transitions UI to authenticated state
  - [x] Sign-out returns to unauthenticated state
  - [x] Cancelled sign-in does not break app state
  - [x] Misconfiguration surfaces a clear error
- [x] Run static analysis (`flutter analyze` / `dart analyze`).
- [x] Smoke-test sign-in on each supported platform.

### 10) Rollout / cleanup
- [x] Remove dead code paths (the placeholder “Not implemented yet” branch).
- [x] Document the final auth architecture (which package, how tokens are obtained, where config lives).
- [x] Ensure no secrets are committed and `.env` handling is correct.